import{w as me}from"./with-props-ap4d8DRX.js";import{q as e,r as c,l as a,w as ue,p as he}from"./chunk-GNGMS2XR-BqdPGk2M.js";import{b as S,u as B,a as pe,c as fe}from"./ChatProvider-DcM48Aw1.js";import{I as ge}from"./Lock-DzxvihWO.js";import"./TooltipProvider-O3xjTkkc.js";const be=new Map([["bold",e.createElement(e.Fragment,null,e.createElement("path",{d:"M208.49,152.49l-72,72a12,12,0,0,1-17,0l-72-72a12,12,0,0,1,17-17L116,187V40a12,12,0,0,1,24,0V187l51.51-51.52a12,12,0,0,1,17,17Z"}))],["duotone",e.createElement(e.Fragment,null,e.createElement("path",{d:"M200,144l-72,72L56,144Z",opacity:"0.2"}),e.createElement("path",{d:"M207.39,140.94A8,8,0,0,0,200,136H136V40a8,8,0,0,0-16,0v96H56a8,8,0,0,0-5.66,13.66l72,72a8,8,0,0,0,11.32,0l72-72A8,8,0,0,0,207.39,140.94ZM128,204.69,75.31,152H180.69Z"}))],["fill",e.createElement(e.Fragment,null,e.createElement("path",{d:"M205.66,149.66l-72,72a8,8,0,0,1-11.32,0l-72-72A8,8,0,0,1,56,136h64V40a8,8,0,0,1,16,0v96h64a8,8,0,0,1,5.66,13.66Z"}))],["light",e.createElement(e.Fragment,null,e.createElement("path",{d:"M204.24,148.24l-72,72a6,6,0,0,1-8.48,0l-72-72a6,6,0,0,1,8.48-8.48L122,201.51V40a6,6,0,0,1,12,0V201.51l61.76-61.75a6,6,0,0,1,8.48,8.48Z"}))],["regular",e.createElement(e.Fragment,null,e.createElement("path",{d:"M205.66,149.66l-72,72a8,8,0,0,1-11.32,0l-72-72a8,8,0,0,1,11.32-11.32L120,196.69V40a8,8,0,0,1,16,0V196.69l58.34-58.35a8,8,0,0,1,11.32,11.32Z"}))],["thin",e.createElement(e.Fragment,null,e.createElement("path",{d:"M202.83,146.83l-72,72a4,4,0,0,1-5.66,0l-72-72a4,4,0,0,1,5.66-5.66L124,206.34V40a4,4,0,0,1,8,0V206.34l65.17-65.17a4,4,0,0,1,5.66,5.66Z"}))]]),ve=new Map([["bold",e.createElement(e.Fragment,null,e.createElement("path",{d:"M144,128a16,16,0,1,1-16-16A16,16,0,0,1,144,128ZM60,112a16,16,0,1,0,16,16A16,16,0,0,0,60,112Zm136,0a16,16,0,1,0,16,16A16,16,0,0,0,196,112Z"}))],["duotone",e.createElement(e.Fragment,null,e.createElement("path",{d:"M240,96v64a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V96A16,16,0,0,1,32,80H224A16,16,0,0,1,240,96Z",opacity:"0.2"}),e.createElement("path",{d:"M140,128a12,12,0,1,1-12-12A12,12,0,0,1,140,128Zm56-12a12,12,0,1,0,12,12A12,12,0,0,0,196,116ZM60,116a12,12,0,1,0,12,12A12,12,0,0,0,60,116Z"}))],["fill",e.createElement(e.Fragment,null,e.createElement("path",{d:"M224,80H32A16,16,0,0,0,16,96v64a16,16,0,0,0,16,16H224a16,16,0,0,0,16-16V96A16,16,0,0,0,224,80ZM60,140a12,12,0,1,1,12-12A12,12,0,0,1,60,140Zm68,0a12,12,0,1,1,12-12A12,12,0,0,1,128,140Zm68,0a12,12,0,1,1,12-12A12,12,0,0,1,196,140Z"}))],["light",e.createElement(e.Fragment,null,e.createElement("path",{d:"M138,128a10,10,0,1,1-10-10A10,10,0,0,1,138,128ZM60,118a10,10,0,1,0,10,10A10,10,0,0,0,60,118Zm136,0a10,10,0,1,0,10,10A10,10,0,0,0,196,118Z"}))],["regular",e.createElement(e.Fragment,null,e.createElement("path",{d:"M140,128a12,12,0,1,1-12-12A12,12,0,0,1,140,128Zm56-12a12,12,0,1,0,12,12A12,12,0,0,0,196,116ZM60,116a12,12,0,1,0,12,12A12,12,0,0,0,60,116Z"}))],["thin",e.createElement(e.Fragment,null,e.createElement("path",{d:"M136,128a8,8,0,1,1-8-8A8,8,0,0,1,136,128Zm-76-8a8,8,0,1,0,8,8A8,8,0,0,0,60,120Zm136,0a8,8,0,1,0,8,8A8,8,0,0,0,196,120Z"}))]]),xe=new Map([["bold",e.createElement(e.Fragment,null,e.createElement("path",{d:"M224,84H180.2l7.61-41.85a12,12,0,0,0-23.62-4.3L155.8,84H116.2l7.61-41.85a12,12,0,1,0-23.62-4.3L91.8,84H48a12,12,0,0,0,0,24H87.44l-7.27,40H32a12,12,0,0,0,0,24H75.8l-7.61,41.85a12,12,0,0,0,9.66,14A11.43,11.43,0,0,0,80,228a12,12,0,0,0,11.8-9.86L100.2,172h39.6l-7.61,41.85a12,12,0,0,0,9.66,14,11.43,11.43,0,0,0,2.16.2,12,12,0,0,0,11.8-9.86L164.2,172H208a12,12,0,0,0,0-24H168.56l7.27-40H224a12,12,0,0,0,0-24Zm-79.83,64H104.56l7.27-40h39.61Z"}))],["duotone",e.createElement(e.Fragment,null,e.createElement("path",{d:"M165.82,96l-11.64,64h-64l11.64-64Z",opacity:"0.2"}),e.createElement("path",{d:"M224,88H175.4l8.47-46.57a8,8,0,0,0-15.74-2.86l-9,49.43H111.4l8.47-46.57a8,8,0,0,0-15.74-2.86L95.14,88H48a8,8,0,0,0,0,16H92.23L83.5,152H32a8,8,0,0,0,0,16H80.6l-8.47,46.57a8,8,0,0,0,6.44,9.3A7.79,7.79,0,0,0,80,224a8,8,0,0,0,7.86-6.57l9-49.43H144.6l-8.47,46.57a8,8,0,0,0,6.44,9.3A7.79,7.79,0,0,0,144,224a8,8,0,0,0,7.86-6.57l9-49.43H208a8,8,0,0,0,0-16H163.77l8.73-48H224a8,8,0,0,0,0-16Zm-76.5,64H99.77l8.73-48h47.73Z"}))],["fill",e.createElement(e.Fragment,null,e.createElement("path",{d:"M116.25,112h31.5l-8,32h-31.5ZM224,48V208a16,16,0,0,1-16,16H48a16,16,0,0,1-16-16V48A16,16,0,0,1,48,32H208A16,16,0,0,1,224,48Zm-16,56a8,8,0,0,0-8-8H168.25l7.51-30.06a8,8,0,0,0-15.52-3.88L151.75,96h-31.5l7.51-30.06a8,8,0,0,0-15.52-3.88L103.75,96H64a8,8,0,0,0,0,16H99.75l-8,32H56a8,8,0,0,0,0,16H87.75l-7.51,30.06a8,8,0,0,0,5.82,9.7,8.13,8.13,0,0,0,2,.24,8,8,0,0,0,7.75-6.06L104.25,160h31.5l-7.51,30.06a8,8,0,0,0,5.82,9.7A8.13,8.13,0,0,0,136,200a8,8,0,0,0,7.75-6.06L152.25,160H192a8,8,0,0,0,0-16H156.25l8-32H200A8,8,0,0,0,208,104Z"}))],["light",e.createElement(e.Fragment,null,e.createElement("path",{d:"M224,90H173l8.89-48.93a6,6,0,1,0-11.8-2.14L160.81,90H109l8.89-48.93a6,6,0,0,0-11.8-2.14L96.81,90H48a6,6,0,0,0,0,12H94.63l-9.46,52H32a6,6,0,0,0,0,12H83L74.1,214.93a6,6,0,0,0,4.83,7A5.64,5.64,0,0,0,80,222a6,6,0,0,0,5.89-4.93L95.19,166H147l-8.89,48.93a6,6,0,0,0,4.83,7,5.64,5.64,0,0,0,1.08.1,6,6,0,0,0,5.89-4.93L159.19,166H208a6,6,0,0,0,0-12H161.37l9.46-52H224a6,6,0,0,0,0-12Zm-74.83,64H97.37l9.46-52h51.8Z"}))],["regular",e.createElement(e.Fragment,null,e.createElement("path",{d:"M224,88H175.4l8.47-46.57a8,8,0,0,0-15.74-2.86l-9,49.43H111.4l8.47-46.57a8,8,0,0,0-15.74-2.86L95.14,88H48a8,8,0,0,0,0,16H92.23L83.5,152H32a8,8,0,0,0,0,16H80.6l-8.47,46.57a8,8,0,0,0,6.44,9.3A7.79,7.79,0,0,0,80,224a8,8,0,0,0,7.86-6.57l9-49.43H144.6l-8.47,46.57a8,8,0,0,0,6.44,9.3A7.79,7.79,0,0,0,144,224a8,8,0,0,0,7.86-6.57l9-49.43H208a8,8,0,0,0,0-16H163.77l8.73-48H224a8,8,0,0,0,0-16Zm-76.5,64H99.77l8.73-48h47.73Z"}))],["thin",e.createElement(e.Fragment,null,e.createElement("path",{d:"M224,92H170.61l9.33-51.28a4,4,0,1,0-7.88-1.44L162.48,92H106.61l9.33-51.28a4,4,0,1,0-7.88-1.44L98.48,92H48a4,4,0,0,0,0,8H97L86.84,156H32a4,4,0,0,0,0,8H85.39l-9.33,51.28a4,4,0,0,0,3.22,4.65A3.65,3.65,0,0,0,80,220a4,4,0,0,0,3.94-3.29L93.52,164h55.87l-9.33,51.28a4,4,0,0,0,3.22,4.65,3.65,3.65,0,0,0,.72.07,4,4,0,0,0,3.94-3.29L157.52,164H208a4,4,0,0,0,0-8H159l10.19-56H224a4,4,0,0,0,0-8Zm-73.16,64H95l10.19-56H161Z"}))]]),ye=new Map([["bold",e.createElement(e.Fragment,null,e.createElement("path",{d:"M188,184a16,16,0,1,1,16-16A16,16,0,0,1,188,184Zm36-68H180a12,12,0,0,0,0,24h40v56H36V140H76a12,12,0,0,0,0-24H32a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V136A20,20,0,0,0,224,116ZM88.49,80.49,116,53v75a12,12,0,0,0,24,0V53l27.51,27.52a12,12,0,1,0,17-17l-48-48a12,12,0,0,0-17,0l-48,48a12,12,0,1,0,17,17Z"}))],["duotone",e.createElement(e.Fragment,null,e.createElement("path",{d:"M232,136v64a8,8,0,0,1-8,8H32a8,8,0,0,1-8-8V136a8,8,0,0,1,8-8H224A8,8,0,0,1,232,136Z",opacity:"0.2"}),e.createElement("path",{d:"M240,136v64a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V136a16,16,0,0,1,16-16H80a8,8,0,0,1,0,16H32v64H224V136H176a8,8,0,0,1,0-16h48A16,16,0,0,1,240,136ZM85.66,77.66,120,43.31V128a8,8,0,0,0,16,0V43.31l34.34,34.35a8,8,0,0,0,11.32-11.32l-48-48a8,8,0,0,0-11.32,0l-48,48A8,8,0,0,0,85.66,77.66ZM200,168a12,12,0,1,0-12,12A12,12,0,0,0,200,168Z"}))],["fill",e.createElement(e.Fragment,null,e.createElement("path",{d:"M74.34,77.66a8,8,0,0,1,0-11.32l48-48a8,8,0,0,1,11.32,0l48,48a8,8,0,0,1-11.32,11.32L136,43.31V128a8,8,0,0,1-16,0V43.31L85.66,77.66A8,8,0,0,1,74.34,77.66ZM240,136v64a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V136a16,16,0,0,1,16-16h68a4,4,0,0,1,4,4v3.46c0,13.45,11,24.79,24.46,24.54A24,24,0,0,0,152,128v-4a4,4,0,0,1,4-4h68A16,16,0,0,1,240,136Zm-40,32a12,12,0,1,0-12,12A12,12,0,0,0,200,168Z"}))],["light",e.createElement(e.Fragment,null,e.createElement("path",{d:"M238,136v64a14,14,0,0,1-14,14H32a14,14,0,0,1-14-14V136a14,14,0,0,1,14-14H80a6,6,0,0,1,0,12H32a2,2,0,0,0-2,2v64a2,2,0,0,0,2,2H224a2,2,0,0,0,2-2V136a2,2,0,0,0-2-2H176a6,6,0,0,1,0-12h48A14,14,0,0,1,238,136ZM84.24,76.24,122,38.49V128a6,6,0,0,0,12,0V38.49l37.76,37.75a6,6,0,0,0,8.48-8.48l-48-48a6,6,0,0,0-8.48,0l-48,48a6,6,0,0,0,8.48,8.48ZM198,168a10,10,0,1,0-10,10A10,10,0,0,0,198,168Z"}))],["regular",e.createElement(e.Fragment,null,e.createElement("path",{d:"M240,136v64a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V136a16,16,0,0,1,16-16H80a8,8,0,0,1,0,16H32v64H224V136H176a8,8,0,0,1,0-16h48A16,16,0,0,1,240,136ZM85.66,77.66,120,43.31V128a8,8,0,0,0,16,0V43.31l34.34,34.35a8,8,0,0,0,11.32-11.32l-48-48a8,8,0,0,0-11.32,0l-48,48A8,8,0,0,0,85.66,77.66ZM200,168a12,12,0,1,0-12,12A12,12,0,0,0,200,168Z"}))],["thin",e.createElement(e.Fragment,null,e.createElement("path",{d:"M236,136v64a12,12,0,0,1-12,12H32a12,12,0,0,1-12-12V136a12,12,0,0,1,12-12H80a4,4,0,0,1,0,8H32a4,4,0,0,0-4,4v64a4,4,0,0,0,4,4H224a4,4,0,0,0,4-4V136a4,4,0,0,0-4-4H176a4,4,0,0,1,0-8h48A12,12,0,0,1,236,136ZM82.83,74.83,124,33.66V128a4,4,0,0,0,8,0V33.66l41.17,41.17a4,4,0,1,0,5.66-5.66l-48-48a4,4,0,0,0-5.66,0l-48,48a4,4,0,0,0,5.66,5.66ZM196,168a8,8,0,1,0-8,8A8,8,0,0,0,196,168Z"}))]]);var He=Object.defineProperty,we=Object.defineProperties,je=Object.getOwnPropertyDescriptors,_=Object.getOwnPropertySymbols,Ee=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable,D=(s,t,l)=>t in s?He(s,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[t]=l,Me=(s,t)=>{for(var l in t||(t={}))Ee.call(t,l)&&D(s,l,t[l]);if(_)for(var l of _(t))Ne.call(t,l)&&D(s,l,t[l]);return s},Ae=(s,t)=>we(s,je(t));const J=c.forwardRef((s,t)=>e.createElement(S,Ae(Me({ref:t},s),{weights:be})));J.displayName="ArrowDown";var Ze=Object.defineProperty,Se=Object.defineProperties,ke=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,Oe=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable,R=(s,t,l)=>t in s?Ze(s,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[t]=l,$e=(s,t)=>{for(var l in t||(t={}))Oe.call(t,l)&&R(s,l,t[l]);if(T)for(var l of T(t))Le.call(t,l)&&R(s,l,t[l]);return s},Fe=(s,t)=>Se(s,ke(t));const W=c.forwardRef((s,t)=>e.createElement(S,Fe($e({ref:t},s),{weights:ve})));W.displayName="DotsThree";var Ie=Object.defineProperty,Ve=Object.defineProperties,Ce=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertySymbols,Pe=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable,X=(s,t,l)=>t in s?Ie(s,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[t]=l,De=(s,t)=>{for(var l in t||(t={}))Pe.call(t,l)&&X(s,l,t[l]);if(U)for(var l of U(t))_e.call(t,l)&&X(s,l,t[l]);return s},Te=(s,t)=>Ve(s,Ce(t));const G=c.forwardRef((s,t)=>e.createElement(S,Te(De({ref:t},s),{weights:xe})));G.displayName="Hash";var Re=Object.defineProperty,Ue=Object.defineProperties,Xe=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertySymbols,qe=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable,z=(s,t,l)=>t in s?Re(s,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):s[t]=l,Be=(s,t)=>{for(var l in t||(t={}))qe.call(t,l)&&z(s,l,t[l]);if(q)for(var l of q(t))ze.call(t,l)&&z(s,l,t[l]);return s},Je=(s,t)=>Ue(s,Xe(t));const K=c.forwardRef((s,t)=>e.createElement(S,Je(Be({ref:t},s),{weights:ye})));K.displayName="Upload";const We=({onClose:s,channel:t})=>{const{users:l}=B(),[p,M]=c.useState([]),[H,g]=c.useState(!1),[x,v]=c.useState(null),y=l.filter(n=>{var m;return!((m=t.member_ids)!=null&&m.includes(n.id))}),j=async n=>{if(n.preventDefault(),p.length!==0){v(null),g(!0);try{const m=await fetch(`https://group-chat.brayden-b8b.workers.dev/channels/${t.id}/invite`,{method:"POST",headers:{"Content-Type":"application/json","X-Session-Id":localStorage.getItem("session")||""},body:JSON.stringify({userIds:p})}),h=await m.json();if(!m.ok)throw new Error(h.message||"Failed to invite users");s()}catch(m){v(m instanceof Error?m.message:"Failed to invite users")}finally{g(!1)}}};return a.jsxs("div",{className:"w-full max-w-lg p-4 bg-neutral-100 dark:bg-neutral-900",children:[a.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Invite users to ",t.name]}),a.jsxs("form",{onSubmit:j,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1",children:"Select users to invite"}),a.jsx("div",{className:"max-h-40 overflow-y-auto border border-neutral-200 dark:border-neutral-700 rounded-md",children:y.length===0?a.jsx("div",{className:"px-3 py-2 text-sm text-neutral-500",children:"No users available to invite"}):y.map(n=>a.jsxs("label",{className:"flex items-center px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800",children:[a.jsx("input",{type:"checkbox",checked:p.includes(n.id),onChange:m=>{M(h=>m.target.checked?[...h,n.id]:h.filter(w=>w!==n.id))},className:"rounded border-neutral-300 dark:border-neutral-700 mr-2"}),n.first_name," ",n.last_name]},n.id))})]}),x&&a.jsx("div",{className:"text-red-500 text-sm",children:x}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-800",children:"Cancel"}),a.jsx("button",{type:"submit",disabled:H||p.length===0,className:"px-4 py-2 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed",children:H?"Inviting...":"Invite Users"})]})]})]})};function Ge({message:s,onChange:t,onSubmit:l,isSending:p=!1,channelId:M,sessionId:H}){const[g,x]=c.useState([]),v=c.useRef(null),y=async n=>{const m=Array.from(n).map(async h=>{const w=new FormData;w.append("file",h);const E=await(await fetch("https://group-chat.brayden-b8b.workers.dev/channel/upload",{method:"POST",headers:{"X-Channel-Id":M,"X-Session-Id":H},body:w})).json();if(!E.success)throw new Error("Upload failed");return{url:E.url,filename:h.name,contentType:h.type,size:h.size}});try{const h=await Promise.all(m);x([...g,...h]),v.current&&(v.current.value="")}catch(h){console.error("Error uploading files:",h)}},j=n=>{n.preventDefault(),y(n.dataTransfer.files)};return a.jsx("div",{onDrop:j,onDragOver:n=>n.preventDefault(),className:"relative",children:a.jsx("form",{onSubmit:n=>{n.preventDefault(),l(n,g.map(m=>m.url)),x([])},className:"p-4 border-t border-neutral-300 dark:border-neutral-800",children:a.jsxs("div",{className:"border border-neutral-200 dark:border-neutral-800 bg-neutral-100 dark:bg-neutral-900 rounded-lg p-2",children:[a.jsx("textarea",{value:s,onChange:n=>t(n.target.value),placeholder:"Message #channel-name",className:"w-full resize-none bg-transparent focus:outline-none",rows:3,disabled:p}),g.length>0&&a.jsx("div",{className:"flex gap-2 mt-2",children:g.map(n=>a.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded bg-neutral-200 dark:bg-neutral-800",children:[a.jsx("span",{children:n.filename}),a.jsx("button",{onClick:()=>x(g.filter(m=>m.url!==n.url)),className:"hover:text-neutral-500",children:"×"})]},n.url))}),a.jsxs("div",{className:"flex justify-end items-center gap-2 mt-2",children:[a.jsx("button",{type:"button",onClick:()=>{var n;return(n=v.current)==null?void 0:n.click()},className:"p-2 hover:bg-gray-100 dark:hover:bg-neutral-800 rounded",children:a.jsx(K,{size:16})}),a.jsx("input",{ref:v,type:"file",multiple:!0,className:"hidden",onChange:n=>y(n.target.files)}),a.jsx("button",{type:"submit",disabled:p||!s.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:p?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Sending..."]}):"Send"})]})]})})})}const a0=me(function(){const{id:t}=ue(),{channels:l,users:p,loadChannelMessages:M,hasMoreMessages:H,onlineUsers:g}=B(),{addMessageListener:x,removeMessageListener:v,isConnected:y,reconnect:j}=pe(),[n,m]=c.useState(""),[h,w]=c.useState(!1),[N,E]=c.useState([]),[k,F]=c.useState(!0),b=c.useRef(null),O=c.useRef(!0),[Q,Y]=c.useState(!1),[I,A]=c.useState(!1),L=c.useRef(null),{openModal:ee,closeModal:te}=fe(),ae=he(),V=c.useMemo(()=>p.reduce((r,o)=>(r[o.id]=o,r),{}),[p]),C=r=>{const o=V[r];return o?(o.first_name[0]+o.last_name[0]).toUpperCase():r.slice(0,2).toUpperCase()},Z=r=>{let o=0;for(let d=0;d<r.length;d++)o=r.charCodeAt(d)+((o<<5)-o);return`hsl(${Math.abs(o%360)}, 70%, 50%)`},P=r=>parseInt(r.split(",")[2].replace("%)",""))>65?"#000000":"#ffffff",i=l.find(r=>r.id.toString()===t),re=()=>{const r=b.current;if(!r)return;const u=r.scrollHeight-r.scrollTop-r.clientHeight<100;O.current=u,Y(!u)},se=()=>{var r;(r=b.current)==null||r.scrollTo({top:b.current.scrollHeight,behavior:"smooth"})},le=c.useCallback(()=>{const r=b.current;if(r){if(r.scrollTop<=50&&H&&!k&&N.length>0&&i){const o=r.scrollHeight,u=N.reduce((d,f)=>f.created_at<d.created_at?f:d);fetch(`https://group-chat.brayden-b8b.workers.dev/channel/messages?before=${u.id}`,{headers:{"X-Session-Id":localStorage.getItem("session")||"","X-Channel-Id":i.id}}).then(d=>d.json()).then(d=>{d.success&&(E(f=>[...f,...d.messages].sort(($,de)=>$.created_at-de.created_at)),requestAnimationFrame(()=>{const f=r.scrollHeight;r.scrollTop=f-o}))}).catch(d=>console.error("Error loading more messages:",d))}re()}},[H,k,N,i==null?void 0:i.id]);c.useEffect(()=>{if(t)return x(t,r=>{E(o=>[...o,r]),O.current&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{const o=b.current;o&&(o.scrollTop=o.scrollHeight)})})}),()=>{v(t)}},[t]),c.useEffect(()=>{(async()=>{if(i){F(!0);try{const u=await(await fetch("https://group-chat.brayden-b8b.workers.dev/channel/messages",{headers:{"X-Session-Id":localStorage.getItem("session")||"","X-Channel-Id":i.id}})).json();u.success?(E(u.messages.reverse()),setTimeout(()=>{var d;(d=b.current)==null||d.scrollTo({top:b.current.scrollHeight,behavior:"instant"})},10)):console.error("Failed to fetch messages")}catch(o){console.error("Error fetching messages:",o)}finally{F(!1)}}})()},[i==null?void 0:i.id]),c.useEffect(()=>{const r=async()=>{y()||j()};return window.addEventListener("focus",r),()=>{window.removeEventListener("focus",r)}},[t,y,j]),c.useEffect(()=>{const r=o=>{L.current&&!L.current.contains(o.target)&&A(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const ne=()=>{i&&(ee(a.jsx(We,{onClose:te,channel:i})),A(!1))},oe=async()=>{try{if(!(await fetch(`https://group-chat.brayden-b8b.workers.dev/channels/${i==null?void 0:i.id}/leave`,{method:"POST",headers:{"X-Session-Id":localStorage.getItem("session")||""}})).ok)throw new Error("Failed to leave channel");ae("/channel/0"),A(!1)}catch(r){console.error("Error leaving channel:",r)}};if(!i)return a.jsx("div",{className:"p-4",children:"Channel not found"});const ce=async(r,o)=>{if(r.preventDefault(),!(!n.trim()||h)){w(!0);try{const u=await fetch("https://group-chat.brayden-b8b.workers.dev/channel/messages",{method:"POST",headers:{"Content-Type":"application/json","X-Channel-Id":i.id,"X-Session-Id":localStorage.getItem("session")||""},body:JSON.stringify({content:n,assets:o})}),d=await u.json();if(!u.ok)throw new Error("Failed to send message");d.success&&d.message&&O.current&&requestAnimationFrame(()=>{var f;(f=b.current)==null||f.scrollTo({top:b.current.scrollHeight,behavior:"smooth"})}),m("")}catch(u){console.error("Error sending message:",u)}finally{w(!1)}}},ie=r=>new Date(r*1e3).toLocaleString();return a.jsxs("div",{className:"flex flex-col h-full",children:[a.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-neutral-200 dark:border-neutral-800",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("h1",{className:"text-lg font-semibold flex items-center gap-2",children:[i.is_private?a.jsx(ge,{className:"w-5 h-5 text-gray-500"}):a.jsx(G,{className:"w-5 h-5 text-gray-500"}),i.name]}),a.jsx("p",{className:"text-sm text-gray-500",children:i.description||"No description available"})]}),a.jsx("div",{className:"flex -space-x-2",children:p.filter(r=>i.member_ids.includes(r.id)).map(r=>a.jsxs("div",{className:"relative",title:`${r.first_name} ${r.last_name}`,children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium bg-blue-500 text-white",style:{backgroundColor:Z(`${r.first_name} ${r.last_name}`),color:P(Z(`${r.first_name} ${r.last_name}`))},children:C(r.id)}),a.jsx("div",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white
                                        ${g.some(o=>o.id===r.id)?"bg-green-500":"bg-gray-400"}`})]},r.id))}),a.jsxs("div",{className:"relative",ref:L,children:[a.jsx("button",{onClick:()=>A(!I),className:"p-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 rounded-full",children:a.jsx(W,{weight:"bold",className:"w-6 h-6"})}),I&&a.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-neutral-800 rounded-md shadow-lg z-10 py-1",children:[a.jsx("button",{onClick:ne,className:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-neutral-100 dark:hover:bg-neutral-700",children:"Invite Users"}),a.jsx("button",{onClick:oe,className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-neutral-100 dark:hover:bg-neutral-700",children:"Leave Channel"})]})]})]}),a.jsxs("div",{className:"flex-1 min-h-0 relative",children:[" ",a.jsx("div",{ref:b,onScroll:le,className:"h-full overflow-y-auto p-4",children:k?a.jsx("div",{className:"flex justify-center items-center h-full",children:a.jsx("div",{className:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})}):a.jsx("div",{className:"space-y-4",children:N.map(r=>{const o=V[r.user_id],u=o?`${o.first_name} ${o.last_name}`:r.user_id.split("-")[0],d=JSON.parse(r.assets);return a.jsxs("div",{className:"flex items-start group",children:[a.jsx("div",{className:"w-9 h-9 rounded flex-shrink-0 flex items-center justify-center font-medium",style:{backgroundColor:Z(u),color:P(Z(u))},children:C(r.user_id)}),a.jsxs("div",{className:"ml-2 min-w-0 flex-1",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:u}),a.jsx("span",{className:"ml-2 text-xs text-gray-500",children:ie(r.created_at)})]}),a.jsx("p",{className:"text-gray-900 dark:text-gray-100",children:r.content}),d.length>0&&a.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:d.map((f,$)=>a.jsx("img",{src:f,alt:"Uploaded content",className:"max-w-[300px] max-h-[300px] rounded-lg"},$))})]})]},r.id)})})}),Q&&a.jsxs("button",{onClick:se,className:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-blue-500 text-white px-4 py-2 rounded-full shadow-lg hover:bg-blue-600 flex items-center gap-2",children:[a.jsx(J,{weight:"bold",className:"w-4 h-4"}),"Scroll to latest"]})]}),a.jsx(Ge,{message:n,onChange:m,onSubmit:ce,isSending:h,channelId:i.id,sessionId:localStorage.getItem("session")||""})]})});export{a0 as default};
